<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>Fate Roulette Mobile</title>

    <style>
      html, body {
          width: 100%;
          height: 100%;
          margin: 0;
          padding: 0;
          background: #000;
          overflow: hidden;
      }

      body {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          font-family: Arial, sans-serif;
      }

      /* Spinner */
      .spinner {
          width: 30px;
          height: 30px;
          margin: 12px;
          border: 5px solid #ebebeb;
          border-top-color: #787878;
          border-radius: 50%;
          animation: spin .8s linear infinite;
      }

      @keyframes spin {
          to { transform: rotate(360deg); }
      }

      #status {
          color: #787878;
          font-weight: bold;
          margin-bottom: 10px;
      }

      /* Canvas container */
      .emscripten_border {
          width: 100%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      canvas {
          background: #000;
          border: none;
          display: block;
          transform: translateZ(0);
          will-change: transform;
      }
    </style>
  </head>

  <body>

    <div class="spinner" id="spinner"></div>
    <div id="status">Downloading…</div>

    <div class="emscripten_border">
      <canvas id="canvas" tabindex="-1"
              oncontextmenu="event.preventDefault()"></canvas>
    </div>

    <script>
      /* ===== Viewport Fix (Android WebView) ===== */
      function fixViewport() {
          const h = window.innerHeight;
          document.documentElement.style.height = h + "px";
          document.body.style.height = h + "px";
      }

      /* ===== Canvas Resize ===== */
      function resizeCanvas() {
          const canvas = Module.canvas;
          if (!canvas) return;

          const dpr = window.devicePixelRatio || 1;
          const w = window.innerWidth;
          const h = window.innerHeight;

          canvas.width  = w * dpr;
          canvas.height = h * dpr;
          canvas.style.width  = w + "px";
          canvas.style.height = h + "px";
      }

      /* ===== Emscripten Module ===== */
      var Module = {
          canvas: document.getElementById("canvas"),

          print: function (text) {
              console.log(text);
          },

          setStatus: function (text) {
              const status = document.getElementById("status");
              const spinner = document.getElementById("spinner");

              if (!text) {
                  spinner.style.display = "none";
                  status.style.display = "none";
              } else {
                  status.textContent = text;
                  spinner.style.display = "block";
              }
          },

          monitorRunDependencies: function (left) {
              Module.setStatus(left
                               ? "Preparing…"
                               : "All downloads complete");
          },

          postRun: [function () {
              fixViewport();
              resizeCanvas();

              window.addEventListener("resize", () => {
                  fixViewport();
                  resizeCanvas();
              });
          }]
      };

      /* ===== Error Handling ===== */
      window.onerror = function (e) {
          console.error(e);
          Module.setStatus("Error – check console");
      };
    </script>

    <!-- ⚠️ MUST NOT BE async -->
    <script src="froullete.js"></script>

  </body>
</html>
